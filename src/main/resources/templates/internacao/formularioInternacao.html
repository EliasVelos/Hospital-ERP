<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${internacao.idInternacao != null ? 'Editar Internação' : 'Nova Internação'}"></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/internacao/styleForm.css}">
    
</head>
<body>

    <div class="container mt-5">
        <!-- Aplicado o estilo glassmorphism CLARO -->
        <div class="main-card shadow-lg">
            <h2 class="text-center page-header mb-4">
                <i class="fas fa-bed me-2"></i> 
                <span th:text="${internacao.idInternacao != null ? 'Editar Internação' : 'Registrar Nova Internação'}"></span>
            </h2>
            
            <!-- Mensagens de Alerta (Visíveis no tema claro) -->
            <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${mensagemSucesso}">Mensagem de Sucesso</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            
            <div th:if="${mensagemErro}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${mensagemErro}">Mensagem de Erro</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <form th:action="@{/internacoes/salvar}" th:object="${internacao}" method="post" class="mt-3">
        
                <input type="hidden" th:field="*{idInternacao}" />
        
                <div class="row">
                    <div class="mb-3 col-md-6">
                        <label for="paciente" class="form-label"><i class="fas fa-user-injured me-1"></i> Paciente</label>
                        <select class="form-select" id="paciente" th:field="*{paciente}" required>
                            <option value="">Selecione um Paciente</option>
                            <option th:each="p : ${pacientes}" 
                                    th:value="${p.idPaciente}" 
                                    th:text="${p.nomePaciente}" 
                                    th:selected="${internacao.paciente != null && internacao.paciente.idPaciente == p.idPaciente}">
                            </option>
                        </select>
                    </div>
            
                    <div class="mb-3 col-md-6">
                        <label for="leito" class="form-label"><i class="fas fa-hospital-alt me-1"></i> Leito</label>
                        <select class="form-select" id="leito" th:field="*{leito}" required>
                            <option value="">Selecione um Leito</option>
                            <option th:each="l : ${leitosDisponiveis}" 
                                    th:text="'Quarto N° ' + ${l.quarto} + ' | Leito N° ' + ${l.numero} + ' (' + ${l.tipo} + ')'" 
                                    th:value="${l.idQuarto}" 
                                    th:selected="${internacao.leito != null && internacao.leito.idQuarto == l.idQuarto}">
                            </option>
                            
                            <!-- Opção para manter o leito atual, se ele não estiver na lista de disponíveis -->
                            <th:block th:if="${internacao.leito != null and !leitosDisponiveis.contains(internacao.leito)}">
                                <option th:value="${internacao.leito.idQuarto}" 
                                        th:text="'Quarto N° ' + ${internacao.leito.quarto} + ' | Leito N° ' + ${internacao.leito.numero} + ' (' + ${internacao.leito.tipo} + ' - Atual)'" 
                                        selected>
                                </option>
                            </th:block>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="mb-3 col-md-6">
                        <label for="dataEntrada" class="form-label">
                            <i class="fas fa-sign-in-alt me-1"></i> Data e Hora de Entrada
                        </label>

                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-calendar-alt"></i>
                            </span>
                            <input type="text" 
                                class="form-control datetimepicker"
                                th:field="*{dataEntrada}" 
                                id="dataEntrada"
                                placeholder="dd/MM/yyyy HH:mm"
                                autocomplete="off"
                                required>
                        </div>
                    </div>

                    <div class="mb-3 col-md-6">
                        <label for="dataAlta" class="form-label">
                            <i class="fas fa-sign-out-alt me-1"></i> Data e Hora de Alta (Opcional)
                        </label>

                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-calendar-check"></i>
                            </span>
                            <input type="text" 
                                class="form-control datetimepicker"
                                th:field="*{dataAlta}" 
                                id="dataAlta"
                                placeholder="dd/MM/yyyy HH:mm"
                                autocomplete="off">
                        </div>
                    </div>
                </div>
        
                <div class="mb-3">
                    <label for="motivoInternacao" class="form-label"><i class="fas fa-comment-medical me-1"></i> Motivo da Internação</label>
                    <input type="text" class="form-control" id="motivoInternacao" th:field="*{motivoInternacao}" required maxlength="255" />
                </div>
        
                <!-- O campo Status foi removido pois ele é determinado pela presença ou ausência da dataAlta -->
                <!-- <div class="mb-3">
                    <label for="status" class="form-label"><i class="fas fa-check-circle me-1"></i> Status</label>
                    <select class="form-select" id="status" th:field="*{status}" required>
                        <option value="Ativa">Ativa</option>
                        <option value="Finalizada">Finalizada</option>
                    </select>
                </div> -->
        
                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                    <a th:href="@{/internacoes/listar}" class="btn btn-secondary me-2 shadow-sm"><i class="fas fa-times me-1"></i> Cancelar</a>
                    <button type="submit" class="btn btn-danger shadow-sm"><i class="fas fa-save me-1"></i> Salvar Internação</button>
                </div>
            </form>
        
            <div align="center" class="mt-4">
                <a th:href="@{/internacoes/listar}" class="btn btn-outline-danger btn-sm">Voltar à lista</a>
            </div>
        </div>
    </div>
    <script th:src="@{/js/internacao/formulario.js}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
    // Aplica máscara dd/MM/yyyy HH:mm
    $(document).ready(function () {
        $('.datetimepicker').mask('00/00/0000 00:00');
    });

    // Ativa o Flatpickr com data e hora
    flatpickr(".datetimepicker", {
        enableTime: true,
        dateFormat: "d/m/Y H:i",
        time_24hr: true,
        allowInput: true
    });
</script>
</body>
</html>